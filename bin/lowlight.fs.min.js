/**
Copyright 2017, Lecoq Simon (lowlight.fr)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/
(function(e){var t=Math.min,n=Math.max,d=Math.floor;"undefined"==typeof e.Lowlight&&(e.Lowlight={}),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=e.Lowlight);class i{constructor(e,t,i,n){this.image=e,this.id=t,this.n=i,this.data=n}set data(e){for(let t in e)t in this&&(this[t]=e[t])}set used(e){e||(this.end=1),this.image.write(this.n,e,32)}get used(){return this.image.read(this.n,32)}set end(e){this.image.write(this.n,e,16)}get end(){return this.image.read(this.n,16)}set next(e){this.image.write(this.n,[e>>16,e>>8,e],[15,255,255])}get next(){let e=this.image.read(this.n,[15,255,255]).reduce((e,t,n,i)=>e+(t<<8*(i.length-1-n)),0);return e===a.NONE?{id:e}:this.image.block(e)}set content(e){this.image.write(this.n+3,e.slice(0,this.image.block_size-3))}get content(){return this.image.read([this.n+3,this.n+this.image.block_size-1])}}class a{constructor(e,t,i,n){this.image=e,this.id=t,this.n=i,this.data=n}set data(e){for(let t in e)if(t in this)try{this[t]=e[t]}catch(t){}}set type(e){this.image.write(this.n,e,128)}get type(){return this.image.read(this.n,128)}set visibility(e){this.image.write(this.n,e,64)}get visibility(){return this.image.read(this.n,64)}set owner(e){this.image.write(this.n,e,63)}get owner(){return this.image.read(this.n,63)}set parent(e){this.image.write(this.n+1,[e>>8,e],[255,255])}get parent(){let e=this.image.read(this.n+1,[255,255]).reduce((e,t,n,i)=>e+(t<<8*(i.length-1-n)),0);return e===a.ROOT||e===a.BLANK?{root:e===a.ROOT,path:"/",name:"/",id:e}:this.image.entry(e)}set block(e){this.image.write(this.n+3,[e>>12,e>>4,e],[255,255,240])}get block(){let e=this.image.read(this.n+3,[255,255,240]).reduce((e,t,n)=>e+(t<<[12,4,0][n]),0);return e===a.NONE?{id:e}:this.image.block(e)}get blocks(){let e=this.block,t=[];if(e.id===a.NONE)return t;for(;t.push(e),!(e.end||e.id===a.NONE);)e=e.next;return t}set creation(e){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");e.y&&(e.y%=a.DATE_OFFSET,this.image.write(this.n+5,[e.y>>4,e.y],[15,240])),e.m&&this.image.write(this.n+6,e.m,15),e.d&&this.image.write(this.n+7,e.d,248),e.h&&this.image.write(this.n+7,[e.h>>2,e.h],[7,192]),e.i&&this.image.write(this.n+8,e.i,63),e.s&&this.image.write(this.n+9,e.s,252)}get creation(){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");return{y:a.DATE_OFFSET+(this.image.read(this.n+5,15)<<4)+this.image.read(this.n+6,240),m:this.image.read(this.n+6,15),d:this.image.read(this.n+7,248),h:(this.image.read(this.n+7,7)<<2)+this.image.read(this.n+8,192),i:this.image.read(this.n+8,63),s:this.image.read(this.n+9,252)}}set edition(e){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");e.y&&(e.y%=a.DATE_OFFSET,this.image.write(this.n+9,[e.y>>6,e.y],[3,252])),e.m&&this.image.write(this.n+10,[e.m>>2,e.m],[3,192]),e.d&&this.image.write(this.n+11,e.d,62),e.h&&this.image.write(this.n+11,[e.h>>4,e.h],[1,240]),e.i&&this.image.write(this.n+12,[e.i>>2,e.i],[15,192]),e.s&&this.image.write(this.n+13,e.s,63)}get edition(){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");return{y:a.DATE_OFFSET+(this.image.read(this.n+9,3)<<6)+this.image.read(this.n+10,252),m:(this.image.read(this.n+10,3)<<2)+this.image.read(this.n+11,192),d:this.image.read(this.n+11,62),h:(this.image.read(this.n+11,1)<<4)+this.image.read(this.n+12,240),i:(this.image.read(this.n+12,15)<<2)+this.image.read(this.n+13,192),s:this.image.read(this.n+13,63)}}set permissions(e){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");let t=0;e.u&&(e.u.r&&(t|=128),e.u.w&&(t|=64),e.u.x&&(t|=32),e.u.d&&(t|=16)),e.o&&(e.o.r&&(t|=8),e.o.w&&(t|=4),e.o.x&&(t|=2),e.o.d&&(t|=1)),this.image.write(this.n+14,t)}get permissions(){if(!this.image.table_extended)throw new Error("Table extended entries data option must be set");let e=this.image.read(this.n+14);return{u:{r:!!(128&e),w:!!(64&e),x:!!(32&e),d:!!(16&e)},o:{r:!!(8&e),w:!!(4&e),x:!!(2&e),d:!!(1&e)}}}set name(e){let t=s.encode(e.trim());if(t.length>this.image.entry_name)throw new Error(`File name too long (${t.length} > ${this.image.entry_name})`);this.image.write(this.n+(this.image.table_extended?a.EXTENDED:a.REDUCED),s.encode("\0".repeat(this.image.entry_name))),this.image.write(this.n+(this.image.table_extended?a.EXTENDED:a.REDUCED),t)}get name(){let e=this.n+(this.image.table_extended?a.EXTENDED:a.REDUCED),t=this.image.read([e,e+this.image.entry_name-1]);for(let e=t.length-1;0<=e&&0===t[e];e--)t.pop();return s.decode(t).trim()}set content(e){if(this.folder)return;this.image.sync(!1);let t=s.encode(e),n=this.image.block_size-3;this.erase();let d=this.image.block_unused;this.block=d.id;for(let a=0;a<t.length;a+=n){if(d.content=s.encode("\0".repeat(this.image.block_size-3)),d.content=t.slice(a,a+n),d.used=1,d.end=0,d.next=this.image.block_unused.id,a+n>=t.length){d.end=1;break}d=d.next}this.image.sync(!0),this.image.sync(0,!0)}get content(){if(this.folder)return null;this.image.sync(!1),this.image.sync(1,!0);let e=this.block,t=[];if(e.id===a.NONE)return"";for(;t.push(...e.content),!(e.end||e.id===a.NONE);)e=e.next;for(let e=t.length-1;0<=e&&0===t[e];e--)t.pop();return this.image.sync(!0),s.decode(t)}erase(){this.folder||(this.image.sync(1,!0),this.blocks.map((e)=>e.used=0),this.image.sync(0,!0))}get file(){return this.type===a.FILE}get folder(){return this.type===a.FOLDER}get visible(){return this.visibility===a.VISIBLE}get hidden(){return this.visibility===a.HIDDEN}get blank(){return this.parent.id===a.BLANK}set blank(e){e?(this.erase(),this.parent=a.BLANK,this.visibility=a.HIDDEN,this.block=a.NONE):(this.parent=a.ROOT,this.visibility=a.VISIBLE)}get path(){let e=this.name,t=this.parent;for(;!t.root;)e=`${t.name}/${e}`,t=t.parent;return`/${e}`}}a.ROOT=0,a.BLANK=65535,a.FILE=1,a.FOLDER=0,a.VISIBLE=1,a.HIDDEN=0,a.NONE=0,a.DATE_OFFSET=2e3,a.EXTENDED=15,a.REDUCED=6,a.NAME=[8,16,24,32];class s{static encode(e){let t=[];return[...e].map((e)=>t.push(...[...s._encode(e)].map((e)=>e.charCodeAt(0)))),t}static _encode(e){return unescape(encodeURIComponent(e))}static decode(e=[]){var t=String.fromCharCode;let n="";for(let d=0;d<e.length;d++)0==(128&e[d])?n+=s._decode(t(e[d])):192==(224&e[d])?n+=s._decode(t(e[d],e[++d])):224==(240&e[d])?n+=s._decode(t(e[d],e[++d],e[++d])):240==(248&e[d])&&(n+=s._decode(t(e[d],e[++d],e[++d],e[++d])));return n}static _decode(e){try{return decodeURIComponent(escape(e))}catch(t){return"\uFFFD"}}}class r{constructor(e,t=null){this.context=e,this.sync(1,!0),this.format(t)}get image_type(){return"Image"}format(e){if(this.sync(!1),null!==e){for(let e=3;e<this.image.data.length;e+=4)this.image.data[e]=255;"Image"===this.image_type&&(this.size=0.75*this._size),this.signature=r.SIGNATURE[this.image_type.toLocaleUpperCase()]||r.SIGNATURE.UNKNOWN,this.crypted=e.crypted,this.entry_name=e.name,this.table_size=e.table,this.table_extended=e.extended,this.block_size=e.block;for(let e=1;e<=this.table_size;e++)this.entry(e).blank=!0;for(let e=1;e<=this.block_number;e++)this.block(e).used=!1}this.sync(0,!0),this.sync(!0)}set signature(e){this.write(0,e,240)}get signature(){return r.SIGNATURE[this.read(0,240)]}set entry_name(e){if(!~a.NAME.indexOf(e))throw new Error(`Entry name max length ${e} is not supported`);this.write(0,a.NAME.indexOf(e),12)}get entry_name(){return a.NAME[this.read(0,12)]}set crypted(e){this.write(0,e,2)}get crypted(){return!!this.read(0,2)}set table_extended(e){this.write(0,e,1)}get table_extended(){return!!this.read(0,1)}set size(e){if(e=d(e),64>e||16777215<e)throw new Error(`Image size must be between 64 and 16777215, ${e} given`);this.write(1,[e>>16,e>>8,e],[255,255,255])}get size(){return this.read(1,[255,255,255]).reduce((e,t,n,i)=>e+(t<<8*(i.length-1-n)),0)}get _size(){return this.data.length}set table_size(e){if(1>e||65534<e)throw new Error(`Table size must be between 1 and 65534, ${e} given`);this.write(4,[e>>8,e],[255,255])}get table_size(){return this.read(4,[255,255]).reduce((e,t,n,i)=>e+(t<<8*(i.length-1-n)),0)}get table_entry(){return this.entry_name+(this.table_extended?a.EXTENDED:a.REDUCED)}set block_size(e){if(32>e||65535<e)throw new Error(`Block size must be between 32 and 65535, ${e} given`);this.write(6,[e>>8,e],[255,255])}get block_size(){return this.read(6,[255,255]).reduce((e,t,n,i)=>e+(t<<8*(i.length-1-n)),0)}get block_number(){return this._block_number_cached||(this._block_number_cached=d((this.size-r.HEADER-this.table_size*this.table_entry)/this.block_size)),this._block_number_cached}get block_unused(){for(let e=1;e<=this.block_number;e++)if(!this.block(e).used)return this.block(e);throw new Error("No more block available")}get free(){let e=0;this.sync(1),this.sync(!1);for(let t=1;t<=this.block_number;t++)e+=this.block(t).used;return this.sync(!0),(this.block_number-e)*(this.block_size-3)}entry(e,t){if(1>e||e>this.table_size)throw new Error(`Entry ${e} out of bounds`);return new a(this,e,r.HEADER+(e-1)*this.table_entry,t)}get entry_unused(){for(let e=1;e<=this.table_size;e++)if(this.entry(e).blank)return this.entry(e);throw new Error("No more entry available")}block(e,t){if(1>e)throw new Error(`Block ${e} out of bounds`);return new i(this,e,r.HEADER+this.table_size*this.table_entry+(e-1)*this.block_size,t)}get width(){return this.context.canvas.width}get height(){return this.context.canvas.height}get data(){return this.image.data}index(e){if(e=d(4*e/3),0>e||e>=this._size)throw new Error(`Index ${e} out of bounds (size ${this._size})`);return e}sync(e=0,t=!1){"boolean"==typeof arguments[0]&&(this.sync_state=arguments[0]);(this.sync_state||t)&&(0===e?(this.context.clearRect(0,0,this.width,this.height),this.context.putImageData(this.image,0,0)):1===e&&(this.image=this.context.getImageData(0,0,this.width,this.height)))}write(e,t,n=255){Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]),t.map((t,i)=>{let d=n[i]||255;this.data[this.index(e+i)]&=~d,this.data[this.index(e+i)]|=t<<r.fset(d)&d}),this.sync(0)}read(e,t=255){this.sync(1),Array.isArray(e)||(e=[e,Array.isArray(t)?e+t.length-1:e]),Array.isArray(t)||(t=[t]);let n=[];for(let d,a=e[0];a<=e[1];a++)d=t[a-e[0]]||255,n.push((this.data[this.index(a)]&d)>>r.fset(d));return 1===n.length?n[0]:n}static fset(e){for(let t=0;8>t;t++)if(e&1<<t)return t;return null}static isImage(e){let t=r.prototype.index.bind({_size:Infinity});return(240&e[t(0)])>>4===r.SIGNATURE.IMAGE}static open(e){let t=e.getImageData(0,0,e.canvas.width,e.canvas.height).data;return o&&r.isPictureImage(t)?new o(e):r.isImage(t)?new r(e):new r(e)}}r.SIGNATURE={IMAGE:12,PICTUREIMAGE:13,UNKNOWN:15,0:$(".text-unimplemented").text(),1:$(".text-unimplemented").text(),2:$(".text-unimplemented").text(),3:$(".text-unimplemented").text(),4:$(".text-unimplemented").text(),5:$(".text-unimplemented").text(),6:$(".text-unimplemented").text(),7:$(".text-unimplemented").text(),8:$(".text-unimplemented").text(),9:$(".text-unimplemented").text(),10:$(".text-unimplemented").text(),11:$(".text-unimplemented").text(),12:$(".text-image").text(),13:$(".text-picture").text(),14:$(".text-unimplemented").text(),15:$(".text-unknown").text()},r.HEADER=8,r.prototype.test=function(e){this.sync(!1),console.assert(this.size===3*(this.width*this.height),"Size mismatch",` : expected ${this._size} instead of ${this.size}`),console.assert(this.crypted==e.crypted,"Crypted bit mismatch",` : expected ${this.crypted} instead of ${e.crypted}`),console.assert(this.entry_name===e.name,"Entry name length mismatch",` : expected ${this.entry_name} instead of ${e.name}`),console.assert(this.table_size===e.table,"Table size mismatch",` : expected ${this.table_size} instead of ${e.table}`),console.assert(this.table_extended==e.extended,"Extended table option mismatch",` : expected ${this.table_extended} instead of ${e.extended}`),console.assert(this.block_size===e.block,"Block size mismatch",` : expected ${this.block_size} instead of ${e.block}`),console.assert(1===this.entry_unused.id,"First unused entry mismatch",` : expected ${1} instead of ${this.entry_unused.id}`),console.assert(1===this.block_unused.id,"First unused block mismatch",` : expected ${1} instead of ${this.block_unused.id}`);for(let t,n=1;n<=this.table_size;n++)t=this.entry(n),console.assert(t.blank,`Entry ${n} status mismatch`,` : expected ${!0} instead of ${t.blank}`),console.assert(t.type===a.FOLDER,`Entry ${n} type mismatch`,` : expected ${a.FOLDER} instead of ${t.type}`),console.assert(t.folder,`Entry ${n} type mismatch`,` : expected ${!0} instead of ${t.folder}`),console.assert(!t.file,`Entry ${n} type mismatch`,` : expected ${!0} instead of ${!t.file}`),console.assert(t.visibility===a.HIDDEN,`Entry ${n} visibility mismatch`,` : expected ${a.HIDDEN} instead of ${t.visibility}`),console.assert(t.hidden,`Entry ${n} visibility mismatch`,` : expected ${!0} instead of ${t.hidden}`),console.assert(!t.visible,`Entry ${n} visibility mismatch`,` : expected ${!0} instead of ${!t.visible}`),console.assert(0===t.owner,`Entry ${n} owner mismatch`,` : expected ${0} instead of ${t.owner}`),console.assert(t.parent.id===a.BLANK,`Entry ${n} parent mismatch`,` : expected ${a.BLANK} instead of ${t.parent}`),console.assert(0===t.block.id,`Entry ${n} block mismatch`,` : expected ${0} instead of ${t.block}`),this.table_extended&&(console.assert(t.creation.y===a.DATE_OFFSET,`Entry ${n} creation date mismatch`,` : expected ${a.DATE_OFFSET} instead of ${t.creation.y}`),console.assert(0===t.creation.m,`Entry ${n} creation date mismatch`,` : expected ${0} instead of ${t.creation.m}`),console.assert(0===t.creation.d,`Entry ${n} creation date mismatch`,` : expected ${0} instead of ${t.creation.d}`),console.assert(0===t.creation.h,`Entry ${n} creation date mismatch`,` : expected ${0} instead of ${t.creation.h}`),console.assert(0===t.creation.i,`Entry ${n} creation date mismatch`,` : expected ${0} instead of ${t.creation.i}`),console.assert(0===t.creation.s,`Entry ${n} creation date mismatch`,` : expected ${0} instead of ${t.creation.s}`),console.assert(t.edition.y===a.DATE_OFFSET,`Entry ${n} edition date mismatch`,` : expected ${a.DATE_OFFSET} instead of ${t.edition.y}`),console.assert(0===t.edition.m,`Entry ${n} edition date mismatch`,` : expected ${0} instead of ${t.edition.m}`),console.assert(0===t.edition.d,`Entry ${n} edition date mismatch`,` : expected ${0} instead of ${t.edition.d}`),console.assert(0===t.edition.h,`Entry ${n} edition date mismatch`,` : expected ${0} instead of ${t.edition.h}`),console.assert(0===t.edition.i,`Entry ${n} edition date mismatch`,` : expected ${0} instead of ${t.edition.i}`),console.assert(0===t.edition.s,`Entry ${n} edition date mismatch`,` : expected ${0} instead of ${t.edition.s}`),console.assert(0==t.permissions.u.r,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.u.r}`),console.assert(0==t.permissions.u.w,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.u.w}`),console.assert(0==t.permissions.u.x,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.u.x}`),console.assert(0==t.permissions.u.d,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.u.d}`),console.assert(0==t.permissions.o.r,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.o.r}`),console.assert(0==t.permissions.o.w,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.o.w}`),console.assert(0==t.permissions.o.x,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.o.x}`),console.assert(0==t.permissions.o.d,`Entry ${n} permissions mismatch`,` : expected ${0} instead of ${t.permissions.o.d}`)),console.assert(0===t.name.length,`Entry ${n} name mismatch`,` : expected ${0} instead of ${t.name.length}`),console.assert(null===t.content,`Entry ${n} content mismatch`,` : expected ${null} instead of ${t.content}`);for(let t,n=1;n<=this.block_number;n++)t=this.block(n),console.assert(!t.used,`Block ${n} status mismatch`,` : expected ${!0} instead of ${!t.used}`),console.assert(0===t.next.id,`Block ${n} next mismatch`,` : expected ${0} instead of ${t.next.id}`),console.assert(1===t.end,`Block ${n} end mismatch`,` : expected ${1} instead of ${t.end}`),console.assert(t.content.length===this.block_size-3,`Block ${n} content mismatch`,` : expected ${this.block_size-3} instead of ${t.content.length}`);let t="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.".substr(4*-this.block_size),n=this.entry_unused,i=this.block_unused;n.type=a.FILE,n.visibility=a.VISIBLE,n.owner=31,n.parent=a.ROOT,n.name="X".repeat(this.entry_name),n.content=t,this.table_extended&&(n.creation={y:2255,m:12,d:31,h:23,i:59,s:59},n.edition={y:2001,m:1,d:1,h:1,i:1,s:1},n.permissions={u:{r:1,w:1,x:1,d:0},o:{r:1,w:0,x:0,d:1}}),console.assert(!n.blank,`Entry test status mismatch`,` : expected ${!1} instead of ${!n.blank}`),console.assert(n.file,`Entry test type mismatch`,` : expected ${!0} instead of ${n.file}`),console.assert(n.visible,`Entry test visibility mismatch`,` : expected ${!0} instead of ${n.visible}`),console.assert(31===n.owner,`Entry test owner mismatch`,` : expected ${31} instead of ${n.owner}`),console.assert(n.parent.root,`Entry test parent mismatch`,` : expected ${!0} instead of ${n.parent.root}`),console.assert(n.block.id===i.id,`Entry test block mismatch`,` : expected ${i.id} instead of ${n.block.id}`),console.assert(n.name.length===this.entry_name,`Entry test name length mismatch`,` : expected ${this.entry_name} instead of ${n.name.length}`),console.assert(n.content===t,`Entry test content mismatch`,` : expected ${t} instead of ${n.content}`),console.assert(this.entry_unused.id!==n.id,`First unused entry mismatch`,` : expected ${this.entry_unused.id} different of ${n.id}`),console.assert(this.block_unused.id!==i.id,`First unused block mismatch`,` : expected ${this.block_unused.id} different of ${i.id}`),this.table_extended&&(console.assert(2255===n.creation.y,`Entry test creation date mismatch`,` : expected ${2255} instead of ${n.creation.y}`),console.assert(12===n.creation.m,`Entry test creation date mismatch`,` : expected ${12} instead of ${n.creation.m}`),console.assert(31===n.creation.d,`Entry test creation date mismatch`,` : expected ${31} instead of ${n.creation.d}`),console.assert(23===n.creation.h,`Entry test creation date mismatch`,` : expected ${23} instead of ${n.creation.h}`),console.assert(59===n.creation.i,`Entry test creation date mismatch`,` : expected ${59} instead of ${n.creation.i}`),console.assert(59===n.creation.s,`Entry test creation date mismatch`,` : expected ${59} instead of ${n.creation.s}`),console.assert(2001===n.edition.y,`Entry test edition date mismatch`,` : expected ${1001} instead of ${n.edition.y}`),console.assert(1===n.edition.m,`Entry test edition date mismatch`,` : expected ${1} instead of ${n.edition.m}`),console.assert(1===n.edition.d,`Entry test edition date mismatch`,` : expected ${1} instead of ${n.edition.d}`),console.assert(1===n.edition.h,`Entry test edition date mismatch`,` : expected ${1} instead of ${n.edition.h}`),console.assert(1===n.edition.i,`Entry test edition date mismatch`,` : expected ${1} instead of ${n.edition.i}`),console.assert(1===n.edition.s,`Entry test edition date mismatch`,` : expected ${1} instead of ${n.edition.s}`),console.assert(1==n.permissions.u.r,`Entry test permissions mismatch`,` : expected ${1} instead of ${n.permissions.u.r}`),console.assert(1==n.permissions.u.w,`Entry test permissions mismatch`,` : expected ${1} instead of ${n.permissions.u.w}`),console.assert(1==n.permissions.u.x,`Entry test permissions mismatch`,` : expected ${1} instead of ${n.permissions.u.x}`),console.assert(0==n.permissions.u.d,`Entry test permissions mismatch`,` : expected ${0} instead of ${n.permissions.u.d}`),console.assert(1==n.permissions.o.r,`Entry test permissions mismatch`,` : expected ${1} instead of ${n.permissions.o.r}`),console.assert(0==n.permissions.o.w,`Entry test permissions mismatch`,` : expected ${0} instead of ${n.permissions.o.w}`),console.assert(0==n.permissions.o.x,`Entry test permissions mismatch`,` : expected ${0} instead of ${n.permissions.o.x}`),console.assert(1==n.permissions.o.d,`Entry test permissions mismatch`,` : expected ${1} instead of ${n.permissions.o.d}`));let d=this.entry_unused,s="The quick brown fox jumps over the lazy dog.";d.data={type:a.FILE,blank:!1},d.content=s,console.assert(d.content===s,`Entry test content mismatch`,` : expected ${s} instead of ${d.content}`),console.assert(n.content===t,`Entry test content mismatch`,` : expected ${t} instead of ${n.content}`),n.blank=!0,console.assert(n.blank,`Entry test status mismatch`,` : expected ${!1} instead of ${n.blank}`),console.assert(this.entry_unused.id===n.id,`First unused entry mismatch`,` : expected ${this.entry_unused.id} equal to ${n.id}`),console.assert(this.block_unused.id===i.id,`First unused block mismatch`,` : expected ${this.block_unused.id} equal to ${i.id}`),this.sync(!0)};class o extends r{constructor(e,t=null){super(e,t)}get image_type(){return"PictureImage"}format(e){if(this.sync(!1),null!==e){for(let e=0;e<this.image.data.length;e++)this.image.data[e]&=252;"PictureImage"===this.image_type&&(this.size=0.25*(0.75*this._size))}super.format(e)}index(e,t=!1){if(e=d(16*e/3),0>e||e>=this._size)throw new Error(`Index ${e} out of bounds`);if(t){let t=new Set;for(let n=e;4>t.size;n++)t.add(super.index(d((3*(n-1)+5)/4)));return Array.from(t).sort()}return e}write(e,t,n=255){Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]),t.map((t,i)=>{let d=n[i]||255;t=t<<r.fset(d)&d,this.index(e+i,!0).map((e,n)=>{let i=(t&3<<2*n)>>2*n,a=(d&3<<2*n)>>2*n;this.data[e]&=~a,this.data[e]|=i&a})}),this.sync(0)}read(e,t=255){this.sync(1),Array.isArray(e)||(e=[e,Array.isArray(t)?e+t.length-1:e]),Array.isArray(t)||(t=[t]);let n=[];for(let i=e[0];i<=e[1];i++){let d=t[i-e[0]]||255,a=0;this.index(i,!0).map((e,t)=>{a+=(3&this.data[e])<<2*t}),n.push((a&d)>>r.fset(d))}return 1===n.length?n[0]:n}debug(){let e=new ImageData(this.width,this.height);for(let t=0;t<this.data.length;t++)e.data[t]=[0,255,255,255][3&this.data[t]];this.context.clearRect(0,0,this.width,this.height),this.context.putImageData(e,0,0)}static fromImage(e){e.sync(!1);let t=new o(e.context,{crypted:e.crypted,name:e.entry_name,table:e.table_size,extended:e.table_extended,block:e.block_size});t.sync(!1),t.write(0,e.read(0,15),15);try{for(let i=4;i<e.size;i++)t.write(i,e.read(i))}catch(t){}return t.sync(0,!0),t}}r.isPictureImage=function(e){let t=o.prototype.index.bind({_size:Infinity}),n=0;return t(0,!0).map((t,i)=>{n+=(3&e[t])<<2*i}),(240&n)>>4===r.SIGNATURE.PICTUREIMAGE};class c{constructor(e,t,n=!1){this.context=$(t),this.image=e,n&&this.init(),c.LAST_INSTANCE=this}entries(e){this.image.sync(1),this.image.sync(!1);let t=[];for(let n,d=1;d<=this.image.table_size;d++)n=this.image.entry(d),n.blank||n.parent.id!==e||t.push(n);return this.image.sync(!0),t}create(e){let t=this.image.entry_unused;if(t.blank=!1,this.image.table_extended){let e=new Date;t.edition=t.creation={y:e.getFullYear(),m:e.getMonth()+1,d:e.getDate(),h:e.getHours(),i:e.getMinutes(),s:e.getSeconds()},t.permissions={u:{r:1,w:1,x:1,d:1},o:{r:1,w:0,x:1,d:0}}}return t.data=e,t.id}path(e,t=a.FOLDER,n=""){let d=a.ROOT;/^\.\//.test(e)&&(e=`/${n}/${e.replace(/^\.\//,"")}/`);let s=`${"/"===e.charAt(0)?"":n}/${e}`.split("/").filter((e)=>e.length);this.image.sync(1),this.image.sync(!1);for(let r=0;r<s.length;r++){if(".."===s[r]){d!==a.ROOT&&(d=this.image.entry(d).parent.id);continue}let i=this.entries(d).filter((e)=>r<s.length-1&&e.folder||r===s.length-1&&e.type===t),o=i.map((e)=>e.name),p=o.indexOf(s[r]);if(0<=p)d=i[p].id;else throw new Error(`ENOENT : ${"/"===e.charAt(0)?"":n}/${e}`)}return this.image.sync(!0),d}parse(e,t=!1){try{let n=this.image.entry(this.path(e,a.FILE)).content,i=t?[]:{};return(n.match(/.+$/gm)||[]).map((e)=>e.trim()).filter((e)=>"#"!==e.charAt(0)).map((e)=>{let n=e.match(/(.*?)=(.*)/);null===n||(t?i.push(n[1]):i[n[1]]=n[2])}),i}catch(n){return t?[]:{}}}update_parsable(e,t){for(let n in e=this.image.entry(this.path(e,a.FILE)),t){let i=new RegExp("^"+n+"=.*?\n","im");i.test(e.content)?e.content=e.content.replace(i,null===t[n]?"":`${n}=${t[n]}\n`):e.content+=`${n}=${t[n]}\n`}}get pwd(){return this.env.PWD||"/"}get env(){return this.parse(c.ENV)}get users(){return this.parse(c.USERS)}get users_list(){return this.parse(c.USERS,!0)}get user(){return this.users_list.indexOf(this.env.USER)}init(){let e=this.create({name:"system",type:a.FOLDER,owner:0,parent:a.ROOT});this.create({name:"env.conf",type:a.FILE,owner:0,parent:e,content:"# Path working directory\nPWD=/home\n# Logged user\nUSER=guest\n# Home directory\nHOME=/home"}),this.create({name:"users.conf",type:a.FILE,owner:0,parent:e,content:"root=alpine\nguest=\n"});this.create({name:"home",type:a.FOLDER,owner:0,parent:a.ROOT})}static eval(e,t){return eval(e)}static bytes_format(e){let t=e.toExponential(2).match(/([.0-9]+)e(.+)$/);return`${(100*parseFloat(t[1])).toString().substr(0,3)} ${["","k","M","G","T"][d((parseInt(t[2])-2)/3)]||""}B`}privileges(e,t="r"){if("number"==typeof e){if(0===e)return this;e=this.image.entry(e)}if(this.admin_mode||!(e instanceof a))return this;if(this.image.table_extended&&!e.permissions[e.owner===this.user?"u":"o"][t])throw new Error("Not enough privileges to perform action");return this}}c.ENV="system/env.conf",c.USERS="system/users.conf",c.HOME="home",c.LAST_INSTANCE=null;class l extends c{constructor(e,t,n){super(e,t,n),this.context.click(()=>this.context.find(".context").remove()).contextmenu((e)=>e.preventDefault()),this.gui_desktop(),this.gui_list("/"),this._gui_window_dragging()}gui_desktop(){this._gui_icon("explorer",l.TEXT.EXPLORER).appendTo(this.context).click(()=>this.gui_list("/")),this.gui_cmd(),this.context.append("<br />"),this.gui_sessions(),this.gui_config(),this.context.append("<br />"),this.gui_image_manager(),this.gui_image_steganography(),this.context.append("<br />"),this.gui_image_save(),this.gui_encrypt(),this.context.contextmenu((e)=>{e.target.isSameNode($(this.context).get(0))&&!$(".app-controller .app-clippy").length&&$(`<div class="app-clippy context"><div>${l.TEXT.CLIPPY}</div></div>`).hide().appendTo(this.context).fadeIn("fast")})}gui_display(e,t){try{let n=this.gui_window(e).addClass("app-windows-image").find(".app-windows-content");$(`<img>`).appendTo(n).on("error",()=>{this.gui_error(new Error("An error occured when trying to open this file as an image file."))}).attr("src",t)}catch(t){this.gui_error(t)}}gui_edit(e,t){try{let n=this.gui_window(e).addClass("app-windows-editor");n.find(".app-windows-content").html(`${t.trim().replace(/\n/g,"<br>")}`).prop("contenteditable",!0).keypress((e)=>{if(13===e.which&&(e.preventDefault(),window.getSelection)){let e=window.getSelection(),t=e.getRangeAt(0),n=document.createElement("br"),i=document.createTextNode("\xA0");return t.deleteContents(),t.insertNode(n),t.collapse(!1),t.insertNode(i),t.selectNodeContents(i),e.removeAllRanges(),e.addRange(t),!1}});let i=$(`<div class="app-windows-save"><img src="${l.ICONS.SAVE}"></div>`).appendTo(n.find(".app-windows-bar"));i.click(()=>{try{let t=$("<div></div>").html(n.find(".app-windows-content").html().replace(/<br\s*[\/]?>/gi,"\n")).text(),i=this.image.entry(this.path(e,a.FILE));this.privileges(i,"w"),i.content=t}catch(t){this.gui_error(t)}})}catch(t){this.gui_error(t)}}gui_play(e,t){try{let n=this.gui_window(e).addClass("app-windows-audio").find(".app-windows-content");$(`<audio autoplay controls>${$(".text-no-audio").text()}</audio>`).appendTo(n).on("error",()=>{this.gui_error(new Error("An error occured when trying to open this file as an audio file."))}).attr("src",t)}catch(t){this.gui_error(t)}}gui_execute(e){try{return c.eval.call(this,e)}catch(t){this.gui_error(t)}}gui_encrypt(){this._gui_icon("encryption",l.TEXT.ENCRYPTION).appendTo(this.context).click(()=>{if(!Lowlight.Random)return this.gui_error(new Error("This feature isn't available (Missing script)"));if(!$(".app-encryption-key").length){let e=this.gui_window(l.TEXT.ENCRYPTION_TOOL).addClass("app-input").find(".app-windows-content");e.append(`<table>
                        <tr><td>${l.TEXT.ENCRYPTION_KEY}</td><td class="app-encryption-key" contenteditable="true"></td></tr>
                        <tr><td colspan="2" class="app-encryption-msg"></td></tr>
                        <tr><td colspan="2">
                            <button class="app-encryption-encrypt">${l.TEXT.ENCRYPTION_ENCRYPT}</button>
                            <button class="app-encryption-decrypt">${l.TEXT.ENCRYPTION_DECRYPT}</button>
                        </td></tr>
                    </table>`),e.find(this.image.crypted?".app-encryption-encrypt":".app-encryption-decrypt").hide(),e.find(".app-encryption-encrypt").click(()=>$(".app-encryption-msg").text(this._gui_encrypt($(".app-encryption-key").text(),1))),e.find(".app-encryption-decrypt").click(()=>$(".app-encryption-msg").text(this._gui_encrypt($(".app-encryption-key").text(),-1)))}})}_gui_encrypt(e,t=1){try{if($(".app-encryption-msg").empty(),!e.length)return l.TEXT.ENCRYPTION_MISSING_KEY;let n=new Lowlight.Random.Distribution.Uniform(0,256).seed(e);this.image.sync(!1),this.image.sync(1,!0);let i=this.image.context;i.fillStyle=0,i.fillRect(0,0,this.width,this.height);for(let e=4;e<this.image.size;e++)this.image.write(e,((this.image.read(e)+t*d(n.next()))%256+256)%256);return this.image.crypted=0<t,this.image.sync(0,!0),this.image.sync(!0),$(".app-encryption-encrypt, .app-encryption-decrypt").toggle(),this.image.crypted?l.TEXT.ENCRYPTION_SUCCESS:l.TEXT.DECRYPTION_SUCCESS}catch(t){this.gui_error(t)}}gui_delete(e,t){try{this.cmd_remove(e),t.remove()}catch(t){this.gui_error(t)}}gui_rename(e,t,n){try{let i=t.find("figcaption").text();if(e.name===i)return;e.name=i,t.remove(),this.gui_icon(e,n)}catch(t){this.gui_error(t)}}gui_mkdir(e,t){try{let n=this.cmd_mkentry(`${e}/${$(".text-new-folder").text()}`,"",a.FOLDER);this.gui_icon(this.image.entry(n),t)}catch(t){this.gui_error(t)}}gui_mkfile(e,t){try{let n=$(".text-new-file").text(),i=this.path(e),d=null;try{this.path(`${e}/${n}`,a.FILE)}catch(t){d=this.create({name:n,parent:i,type:a.FILE,owner:this.user})}if(null!==d)return this.gui_icon(this.image.entry(d),t),d;throw new Error(`Couldn't create file ${e}/${n}`)}catch(t){this.gui_error(t)}}gui_move(e,t,n){let i=this.gui_window($(".text-move-to").text()).addClass("app-input").find(".app-windows-content");i.append(`<table>
                <tr><td>${l.TEXT.MOVE_TO}</td><td class="app-move-to-path" contenteditable="true"></td></tr>
                <tr><td colspan="2" class="app-move-to-msg"></td></tr>
                <tr><td colspan="2"><button class="app-move-to-validate">${l.TEXT.VALIDATE}</button></td></tr>
            </table>`),i.find(".app-move-to-validate").click(()=>{try{let d=i.find(".app-move-to-path").text().trim(),a=n.find(".app-windows-title").text()+"/";d=/^\.\//.test(d)?d.replace(/^\.\//,a):"/"+d;try{this.path(d,e.type,a)}catch(a){this._gui_move(d,e,t,i,n)}i.find(".app-move-to-msg").text(l.TEXT.INVALID_PATH)}catch(t){this.gui_error(t)}})}_gui_move(e,t,n,i,d){let a=e.match(/\/([a-zA-Z.0-9]+)$/)[1];try{let s=this.path(e.replace(new RegExp(a+"$"),""));t.name=a,t.parent=s,i.parent().remove(),n.remove(),this.path(pwd)===s&&this.gui_icon(t,d)}catch(e){}}gui_icon(e,t){try{let n=this._gui_icon("file-misc",e.name).appendTo(t.find(".app-windows-content"));return e.hidden&&n.addClass("app-entry-hidden"),e.file?(/\.(?:jpeg|jpg|gif|png|apng|svg|bmp|ico)$/.test(e.name)?(n.find("img").attr("src",l.ICONS.IMG),n.click((t)=>{t.stopPropagation();try{this.privileges(e).gui_display(e.path,e.content)}catch(t){this.gui_error(t)}})):/\.(?:mp3|mpeg|ogg|wav)$/.test(e.name)?(n.find("img").attr("src",l.ICONS.AUDIO),n.click((t)=>{t.stopPropagation();try{this.privileges(e).gui_play(e.path,e.content)}catch(t){this.gui_error(t)}})):/\.txt$/.test(e.name)?(n.find("img").attr("src",l.ICONS.TEXT),n.click((t)=>{t.stopPropagation();try{this.privileges(e).gui_edit(e.path,e.content)}catch(t){this.gui_error(t)}})):/\.conf$/.test(e.name)&&(n.find("img").attr("src",l.ICONS.CONF),n.click((t)=>{t.stopPropagation();try{this.privileges(e).gui_edit(e.path,e.content)}catch(t){this.gui_error(t)}})),/\.cmd$/.test(e.name)&&(n.find("img").attr("src",l.ICONS.CMD),n.click((t)=>{t.stopPropagation();try{this.privileges(e,"x").gui_execute(e.content)}catch(t){this.gui_error(t)}}))):e.folder&&(n.find("img").attr("src",this.entries(e.id).length?l.ICONS.FOLDER_FILES:l.ICONS.FOLDER_EMPTY),n.click((n)=>{n.stopPropagation();try{this.privileges(e,"r").gui_list(e.path,t)}catch(t){this.gui_error(t)}})),n.contextmenu((i)=>{i.preventDefault(),i.stopPropagation(),this.context.click();let d={x:parseInt(i.pageX-this.context.offset().left),y:parseInt(i.pageY-this.context.offset().top)},a=$(`<ul class="context">
                        <li>${l.TEXT.OPEN_WITH}</li>
                        <li>${l.TEXT.RENAME}</li>
                        <li>${l.TEXT.REMOVE}</li>
                        <li>${l.TEXT.MOVE_TO}</li>
                        <li>${l.TEXT.PROPERTIES}</li>
                    </ul>`).appendTo(this.context);d.x>l.WIDTH*l.INVERT_CONTEXT?a.css("right",l.WIDTH-d.x):a.css("left",d.x),d.y>l.HEIGHT*l.INVERT_CONTEXT?a.css("bottom",l.HEIGHT-d.y):a.css("top",d.y),e.folder?a.find("li:nth-child(1)").text($(".text-open-directory").text()).click(()=>n.click()):a.find("li:nth-child(1)").hover(()=>{let t=$(`<ul class="context subcontext">
                                <li>${l.TEXT.OPEN_WITH_TEXT}</<li>
                                <li>${l.TEXT.OPEN_WITH_IMAGE}</<li>
                                <li>${l.TEXT.OPEN_WITH_AUDIO}</<li>
                                <li>${l.TEXT.OPEN_WITH_CMD}</<li>
                            </ul>`).appendTo(a.find("li:nth-child(1)")).css("top",0).css("left",a.width());t.find("li:nth-child(1)").click(()=>{try{this.privileges(e).gui_edit(e.path,e.content)}catch(t){this.gui_error(t)}}),t.find("li:nth-child(2)").click(()=>{try{this.privileges(e).gui_display(e.path,e.content)}catch(t){this.gui_error(t)}}),t.find("li:nth-child(3)").click(()=>{try{this.privileges(e).gui_play(e.path,e.content)}catch(t){this.gui_error(t)}}),t.find("li:nth-child(4)").click(()=>{try{this.privileges(e).gui_execute(e.content)}catch(t){this.gui_error(t)}})},()=>$("ul.context.subcontext").remove()),a.find("li:nth-child(2)").click(()=>{try{this.privileges(e,"w");let i=n.find("figcaption");i.focusout(()=>{i.prop("contenteditable",!1),this.gui_rename(e,n,t)}).keypress((e)=>{13===e.which&&i.focusout()}).prop("contenteditable",!0).focus();let d=document.createRange();d.selectNodeContents(i.get(0));let a=window.getSelection();a.removeAllRanges(),a.addRange(d)}catch(t){this.gui_error(t)}}),a.find("li:nth-child(3)").click(()=>{try{this.privileges(e,"d").gui_delete(e,n)}catch(t){this.gui_error(t)}}),a.find("li:nth-child(4)").click(()=>{try{this.privileges(e,"w").gui_move(e,n,t)}catch(t){this.gui_error(t)}}),a.find("li:nth-child(5)").click(()=>{try{this.gui_properties(e)}catch(t){this.gui_error(t)}})}),n}catch(t){this.gui_error(t)}}_gui_icon(e,t){return $(`
        <figure>
            <img src="${l.ICONS._DIR}${e}.png">
            <figcaption>${t}</figcaption>
        </figure>`)}gui_list(e=this.pwd,t){try{if(this.image.crypted)throw new Error("Image is encrypted");let n=this.path(e,a.FOLDER);t===void 0&&(t=this.gui_window(e).attr("data-path",e),t.find(".app-windows-content").contextmenu((e)=>{e.preventDefault(),this.context.click();let n={x:parseInt(e.pageX-this.context.offset().left),y:parseInt(e.pageY-this.context.offset().top)},i=$(`
                                <ul class="context">
                                    <li>${l.TEXT.MK_NEW_FILE}</li>
                                    <li>${l.TEXT.MK_NEW_FOLDER}</li>
                                    <li>${l.TEXT.SHOW_HIDDEN}</li>
                                    <li>${l.TEXT.PROPERTIES}</li>
                                </ul>
                            `).appendTo(this.context);n.x>l.WIDTH*l.INVERT_CONTEXT?i.css("right",l.WIDTH-n.x):i.css("left",n.x),n.y>l.HEIGHT*l.INVERT_CONTEXT?i.css("bottom",l.HEIGHT-n.y):i.css("top",n.y);let d=t.attr("data-path"),a=this.path(d);i.find("li:nth-child(1)").click(()=>{try{this.privileges(a,"w").gui_mkfile(d,t)}catch(t){this.gui_error(t)}}),i.find("li:nth-child(2)").click(()=>{try{this.privileges(a,"w").gui_mkdir(d,t)}catch(t){this.gui_error(t)}}),i.find("li:nth-child(3)").click(()=>{t.attr("data-hidden","show"==t.attr("data-hidden")?"hidden":"show")}),i.find("li:nth-child(4)").click(()=>{try{this.gui_properties(this.image.entry(a))}catch(t){this.gui_error(t)}}),0==a&&i.find("li:nth-child(4)").remove()}));let i=t.attr("data-path",e).find(".app-windows-title").text(e).end().find("figure").remove().end().find(".app-windows-content"),d=this.entries(n);n!==a.ROOT&&this._gui_icon("folder-parent","../").appendTo(i).click(()=>{try{this.gui_list(this.image.entry(n).parent.path,t)}catch(t){this.gui_error(t)}}),d.sort((e,t)=>e.folder&&!t.folder?-1:!e.folder&&t.folder?1:e.name>t.name),d.map((e)=>this.gui_icon(e,t))}catch(t){this.gui_error(t)}}gui_image_manager(){let e=$(`<input type="file" name="app-load-image" />`).attr("data-app-icon","dload").appendTo(this.context);e.on("change",(e)=>this._gui_load_image(e,()=>r.open($(".app-view canvas").get(0).getContext("2d")))),this._gui_icon("image-manager",l.TEXT.IMAGE_MANAGER).appendTo(this.context).click((t)=>{t.stopPropagation(),e.click()})}gui_image_steganography(){let e=$(`<input type="file" name="app-load-image" />`).appendTo(this.context);e.on("change",(e)=>this._gui_load_image(e,()=>o.fromImage(this.image)));this._gui_icon("image-steganography",l.TEXT.IMAGE_MANAGER_STEGANO).appendTo(this.context).click((t)=>{if(t.stopPropagation(),!$(".app-steganography").length){this.gui_alert(l.TEXT.STEGANOGRAPHY_TOOL,l.TEXT.STEGANOGRAPHY_INFO,()=>{e.click()}).addClass("app-steganography")}})}_gui_load_image(e,t){try{let n=(e)=>{let n=this.image.context;n.canvas.width=e.width,n.canvas.height=e.height,n.fillStyle=0,n.fillRect(0,0,e.width,e.height),n.drawImage(e,0,0);let i=t();this.context.empty(),new l(i,$(".app-controller").get(0))},i=$(e.target).get(0).files[0];if(5e6<i.size)throw new Error("Image too big");if(FileReader&&i){let e=new FileReader;e.onload=()=>{let t=$("<img>").attr("src",e.result).on("load",()=>n(t.get(0)))},e.readAsDataURL(i)}else throw new Error("Invalid file or missing FileReader")}catch(t){this.gui_error(t)}}gui_image_save(){this._gui_icon("image-save",l.TEXT.IMAGE_SAVE).appendTo(this.context).wrap($("<a>").attr("href",$(".app-view canvas").get(0).toDataURL()).prop("download","image.png").css("background-color","inherit").css("color","inherit").css("font","inherit"))}gui_properties(e){try{let t=$(`<table>
                <tr><td>${l.TEXT.NAME}</td><td>${e.name}</td></tr>
                <tr><td>${l.TEXT.PARENT}</td><td>${e.parent.name}</td></tr>
                <tr><td>${l.TEXT.BLOCK}</td><td>${e.block.id}</td></tr>
                <tr><td>${l.TEXT.SIZE}</td><td>${e.file?c.bytes_format(e.blocks.length*this.image.block_size):"-"}</td></tr>
                <tr><td>${l.TEXT.TYPE}</td><td>${e.file?l.TEXT.FILE:l.TEXT.FOLDER}</td></tr>
                <tr><td>${l.TEXT.VISIBILITY}</td><td>${e.visible?l.TEXT.VISIBLE:l.TEXT.HIDDEN}</td></tr>
                <tr><td>${l.TEXT.OWNER}</td><td>${this.users_list[e.owner]}</td></tr>
            </table>`);if(this.image.table_extended){let n=e.creation,i=e.edition,d=e.permissions;t.append(`
                    <tr><td>${l.TEXT.CREATION}</td><td>${`${n.d}/${n.m}/${n.y}, ${n.h}:${n.m}:${n.s}`}</td></tr>
                    <tr><td>${l.TEXT.EDITION}</td><td>${`${i.d}/${i.m}/${i.y}, ${i.h}:${i.m}:${i.s}`}</td></tr>
                    <tr><td colspan="2"><table class="app-entry-properties-permissions">
                        <tr><th>${l.TEXT.PERMISSIONS}</th><th>${l.TEXT.PERMISSIONS_OWNER}</th><th>${l.TEXT.PERMISSIONS_OTHERS}</th></tr>
                        <tr><td>${l.TEXT.PERMISSIONS_R}</td>
                            <td>${d.u.r?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td>
                            <td>${d.o.r?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td></tr>
                        <tr><td>${l.TEXT.PERMISSIONS_W}</td>
                            <td>${d.u.w?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td>
                            <td>${d.o.w?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td></tr>
                        <tr><td>${l.TEXT.PERMISSIONS_X}</td>
                            <td>${d.u.x?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td>
                            <td>${d.o.x?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td></tr>
                        <tr><td>${l.TEXT.PERMISSIONS_D}</td>
                            <td>${d.u.d?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td>
                            <td>${d.o.d?l.TEXT.PERMISSIONS_Y:l.TEXT.PERMISSIONS_N}</td></tr>
                    </table></td></tr>`)}this.gui_window(l.TEXT.PROPERTIES).addClass("app-entry-properties").find(".app-windows-content").append(t)}catch(t){throw t}}gui_config(){let e=this._gui_icon("config",l.TEXT.CONFIG).attr("data-app-icon","dstat").appendTo(this.context);e.click(()=>{try{if($(".app-disk-properties").length)return;let e=$(`<table>
                    <tr><td>${l.TEXT.CONFIG_SIGNATURE}</td>
                        <td>${this.image.signature}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_CRYPTED}</td>
                        <td>${this.image.crypted?l.TEXT.CONFIG_Y:l.TEXT.CONFIG_N}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_SIZE}</td>
                        <td>${c.bytes_format(this.image.size)}</td></tr>
                </table>`);this.gui_window(l.TEXT.PROPERTIES).addClass("app-disk-properties").find(".app-windows-content").append(e),this.image.crypted||$(`<tr><td>${l.TEXT.CONFIG_USED}</td>
                        <td>${c.bytes_format(this.image.size-this.image.free)}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_FREE}</td>
                        <td>${c.bytes_format(this.image.free)}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_WIDTH}</td>
                        <td>${this.image.width}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_HEIGHT}</td>
                        <td>${this.image.height}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_TABLE_SIZE}</td>
                        <td>${this.image.table_size}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_TABLE_EXTENDED}</td>
                        <td>${this.image.table_extended?l.TEXT.CONFIG_Y:l.TEXT.CONFIG_N}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_ENTRY_NAME}</td>
                        <td>${this.image.entry_name}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_BLOCK_SIZE}</td>
                        <td>${c.bytes_format(this.image.block_size)}</td></tr>
                    <tr><td>${l.TEXT.CONFIG_BLOCK_NUMBER}</td>
                        <td>${this.image.block_number}</td></tr>`).appendTo(e)}catch(t){this.gui_error(t)}})}gui_sessions(){let e=this._gui_icon("sessions",l.TEXT.SESSIONS).appendTo(this.context);e.click(()=>{if(!$(".app-sessions").length)try{let e=this.gui_window(l.TEXT.SESSIONS).addClass("app-sessions").find(".app-windows-content");e.append(`<table>
                            <tr><td colspan="2">${l.TEXT.LOGGED_AS.replace("%s",this.env.USER)}</td></tr>
                            <tr><td>${l.TEXT.SESSIONS_USER}</td><td class="app-sessions-user" contenteditable="true"></td></tr>
                            <tr><td class="app-sessions-">${l.TEXT.SESSIONS_PASSWORD}</td><td class="app-sessions-password" contenteditable="true"></td></tr>
                            <tr><td colspan="2" class="app-sessions-msg"></td></tr>
                            <tr><td colspan="2">
                                <button class="app-sessions-remove">${l.TEXT.SESSIONS_REMOVE}</button>
                                <button class="app-sessions-create">${l.TEXT.SESSIONS_CREATE}</button>
                                <button class="app-sessions-login">${l.TEXT.SESSIONS_LOGIN}</button>
                            </td></tr></table>`),$(".app-sessions-remove, .app-sessions-login, .app-sessions-create").hide(),e.find(".app-sessions-user, .app-sessions-password").keyup(()=>this._gui_sessions((e)=>{this.image.sync(!1),0<=this.users_list.indexOf(e)?($(".app-sessions-remove, .app-sessions-login").addClass("disabled").show(),this.users[e]===$(".app-sessions-password").text()&&$(".app-sessions-remove, .app-sessions-login").removeClass("disabled")):$(".app-sessions-create").show(),this.image.sync(!0)})),e.find(".app-sessions-remove").click(()=>this._gui_sessions((e)=>{let t=this.image.entry(this.path(c.USERS,a.FILE));t.content=t.content.replace(new RegExp(`${e}=.*?\n`,"i"),"")},"remove")),e.find(".app-sessions-create").click(()=>this._gui_sessions((e)=>{this.image.entry(this.path(c.USERS,a.FILE)).content+=`${e}=${$(".app-sessions-password").text()}\n`},"create")),e.find(".app-sessions-login").click(()=>this._gui_sessions((e)=>{if(0<=this.users_list.indexOf(e)&&this.users[e]===$(".app-sessions-password").text()){let t=this.image.entry(this.path(c.ENV,a.FILE));t.content=t.content.replace(/USER=.*?\n/i,`USER=${e}\n`)}},"login"))}catch(t){this.gui_error(t)}})}_gui_sessions(e,t){try{let n=$(".app-sessions-user").text().trim();if(0==n.length)return;$(".app-sessions-remove, .app-sessions-login, .app-sessions-create").hide(),e(n),t?($(".app-sessions-msg").text(l.TEXT[`SESSIONS_${t}_DONE`].replace("%s",n)),$(".app-sessions-user, .app-sessions-password").empty()):$(".app-sessions-msg").empty()}catch(t){this.gui_error(t)}}get admin_mode(){return 0===this.user}_gui_cmd_eval(e,t){let i,d,s,o,u,m,g,p,f,E,_,x,T,I=e.split(" ").filter((e)=>e.length),h=$("<li></li>");try{switch(I[0]){case"pwd":h.text(this.pwd);break;case"env":h.text(this.image.entry(this.path(c.ENV,a.FILE)).content);break;case"whoami":h.text(`${this.env.USER} (user nÂ° ${this.user})`);break;case"explorer":this.gui_list(I[1]||this.pwd);break;case"terminal":$(".app-controller [data-app-icon=cmd]").click();break;case"edit":this.gui_edit(I[1],this.image.entry(this.path(I[1],a.FILE,this.pwd)).content);break;case"play":this.gui_play(I[1],this.image.entry(this.path(I[1],a.FILE,this.pwd)).content);break;case"display":this.gui_display(I[1],this.image.entry(this.path(I[1],a.FILE,this.pwd)).content);break;case"exec":this.gui_execute(this.image.entry(this.path(I[1],a.FILE,this.pwd)).content);break;case"cd":d=this.path(I[1]||this.env.HOME,a.FOLDER,this.pwd),this.update_parsable(c.ENV,{PWD:1>d?"/":this.image.entry(d).path});break;case"mkdir":this.cmd_mkentry(I[1],this.pwd,a.FOLDER);break;case"mkfile":this.cmd_mkentry(I[1],this.pwd,a.FILE);break;case"rm":i=I.filter((e)=>"-"!==e.charAt(0)),this.cmd_remove(this.image.entry(this.path(i[1],0<I.indexOf("-r")?a.FOLDER:a.FILE,this.pwd)));break;case"chown":i=I.filter((e)=>"-"!==e.charAt(0)),this.image.entry(this.path(i[1],0<I.indexOf("-f")?a.FOLDER:a.FILE,this.pwd)).owner=n(0,this.users_list.indexOf(i[2]));break;case"stat":i=I.filter((e)=>"-"!==e.charAt(0)),o=this.image.entry(this.path(i[1],0<I.indexOf("-f")?a.FOLDER:a.FILE,this.pwd)),this.gui_properties(o);break;case"chmod":i=I.filter((e)=>"-"!==e.charAt(0)&&"+"!==e.charAt(0)),o=this.image.entry(this.path(i[1],0<I.indexOf("-f")?a.FOLDER:a.FILE,this.pwd)),i=o.permissions,0<I.indexOf("-r")?i.u.r=!1:0<I.indexOf("+r")&&(i.u.r=!0),0<I.indexOf("-w")?i.u.w=!1:0<I.indexOf("+w")&&(i.u.w=!0),0<I.indexOf("-x")?i.u.x=!1:0<I.indexOf("+x")&&(i.u.x=!0),0<I.indexOf("-d")?i.u.d=!1:0<I.indexOf("+d")&&(i.u.d=!0),0<I.indexOf("-R")?i.o.r=!1:0<I.indexOf("+R")&&(i.o.r=!0),0<I.indexOf("-W")?i.o.w=!1:0<I.indexOf("+W")&&(i.o.w=!0),0<I.indexOf("-X")?i.o.x=!1:0<I.indexOf("+X")&&(i.o.x=!0),0<I.indexOf("-D")?i.o.d=!1:0<I.indexOf("+D")&&(i.o.d=!0),o.permissions=i;break;case"mv":i=I.filter((e)=>"-"!==e.charAt(0)),o=this.image.entry(this.path(i[1],0<I.indexOf("-f")?a.FOLDER:a.FILE,this.pwd));try{this.path(path,o.type,this.pwd)}catch(t){f=(i[2].match(/\/([a-zA-Z.0-9]+)$/)||[,i[2]])[1],E=this.path(i[2].replace(new RegExp(f+"$"),""),a.FOLDER,this.pwd),o.name=f,o.parent=E}break;case"ls":i=I.filter((e)=>"-"!==e.charAt(0)),i=this.entries(this.path(i[1]||this.pwd,a.FOLDER,this.pwd)),u=(e.match(/-type=(FILE|FOLDER)/)||[,"ALL"])[1],"ALL"!==u&&("FILE"===u&&(i=i.filter((t)=>t.file)),"FOLDER"===u&&(i=i.filter((t)=>t.folder))),-1===I.indexOf("-a")&&(i=i.filter((t)=>t.visible)),0<I.indexOf("-l")?(m=this.image.table_extended,s=i.map((t)=>(p=t.folder?"f":"-",m&&(g=t.permissions,p+=`${g.u.r?"r":"-"}${g.u.w?"w":"-"}${g.u.x?"x":"-"}${g.u.d?"d":"-"}`,p+=`${g.o.r?"r":"-"}${g.o.w?"w":"-"}${g.o.x?"x":"-"}${g.o.d?"d":"-"}`),p+=`\u00a0${((this.users_list[t.owner]||"")+"\xA0".repeat("6")).substr(0,6)}`,m&&(p+=`\u00a0${`${t.edition.d}/${t.edition.m}/${t.edition.y}`}`),p+=`\u00a0${((t.name||"")+"\xA0".repeat("18")).substr(0,18)}`,p)).join("\n")):s=i.map((t)=>t.name).join("\n"),h.text(s);break;case"tree":i=I.filter((e)=>"-"!==e.charAt(0)),i=this.entries(this.path(i[1]||this.pwd,a.FOLDER,this.pwd)),p="",_=0<I.indexOf("-a");let t=(e,n=0)=>{e.map((i)=>{i.hidden&&!_||(p+=`${"\xA0".repeat(2*n)+"\u2514\u2500"}${i.name}\n`,i.folder&&t(this.entries(i.id),n+1))})};t(i),h.text(p);break;case"encrypt":if(this.image.crypted)throw new Error("Image already encrypted");h.text(this._gui_encrypt(I[1],1));break;case"decrypt":if(!this.image.crypted)throw new Error("Image already decrypted");h.text(this._gui_encrypt(I[1],1));break;case"adduser":if(I[2]=I[2]||"",0<this.users_list.indexOf(I[1]))throw new Error("User already exists");i={},i[I[1]]=I[2]||"",this.update_parsable(c.USERS,i),$("li:last-child div").text(I[2].length?e.replace(new RegExp(I[2]+"s*$"),"****"):`${e} ****`);break;case"deluser":if(I[2]=I[2]||"",this.users[I[1]]!==I[2])throw new Error("Wrong username/password");if(this.env.USER===I[1])throw new Error("Can't delete yourself");i={},i[I[1]]=null,this.update_parsable(c.USERS,i),$("li:last-child div").text(I[2].length?e.replace(new RegExp(I[2]+"s*$"),"****"):`${e} ****`);break;case"su":if(I[2]=I[2]||"",this.users[I[1]]!==I[2])throw new Error("Wrong username/password");this.update_parsable(c.ENV,{USER:I[1]}),$("li:last-child div").text(I[2].length?e.replace(new RegExp(I[2]+"s*$"),"****"):`${e} ****`);break;case"users":h.text(this.users_list.join("\n"));break;case"dstat":$(".app-controller [data-app-icon=dstat]").click();break;case"dload":$(".app-controller [data-app-icon=dload]").click();break;case"dformat":if(x=e.match(/-size=(\d+)x(\d+)/)||[,400,400],T=this.image.context,T.canvas.width=parseInt(x[1]),T.canvas.height=parseInt(x[2]),T.fillStyle=0,T.fillRect(0,0,T.canvas.width,T.canvas.height),this.context.empty(),new l(new r(this.image.context,{crypted:0,table:parseInt((e.match(/-table-size=(\d+)/)||[,512])[1]),block:parseInt((e.match(/-block-size=(\d+)/)||[,256])[1]),name:parseInt((e.match(/-entry-name-length=(\d+)/)||[,32])[1]),extended:"y"===(e.match(/-table-extended=(y|n)/)||[,"y"])[1]?1:0}),this.context))return;case"help":h.text($(`[data-app-help=${I[1]||"help"}]`).text().trim());break;default:throw new Error(`Unknown command ${I[0]}`);}}catch(t){h.text(`${t.name} : ${t.message}`).addClass("app-cmd-error")}h.text().length&&h.html(h.text().replace(/\n/g,"<br>")).appendTo(t),this._gui_cmd_new_line(t)}gui_cmd(){let e=this._gui_icon("terminal",l.TEXT.TERMINAL).attr("data-app-icon","cmd").appendTo(this.context);e.click(()=>{let e=this.gui_window(l.TEXT.TERMINAL_FULL).addClass("app-windows-terminal").find(".app-windows-content"),t=$(`<ul></ul>`).appendTo(e);this._gui_cmd_new_line(t),e.click(()=>t.find("li:last-child div").focus())})}_gui_cmd_new_line(e){e.find("li:last-child div").prop("contenteditable",!1).off("keypress").off("keydown"),$(`<li>${this.env.USER||""} - ${this.pwd}: <div></div></li>`).appendTo(e).find("div").prop("contenteditable",!0).keypress((t)=>{13===t.which&&(t.preventDefault(),this._gui_cmd_eval($(t.target).text().trim(),e),e.parent().click())}).keydown((e)=>{9===e.which&&(e.preventDefault(),this._gui_cmd_autocomplete($(e.target).text().trim(),$(e.target)))}).focus()}_gui_cmd_autocomplete(e,t){let n=[],i=e.split(" ").filter((e)=>e.length);if(1===i.length)n=l.COMMANDS;else if(1<i.length)switch(i[1]){case("deluser","su"):n=this.users_list;break;case"dformat":n=["-size=","-table-size=","-block-size=","-entry-name-length=","-table-extended="];break;case"help":n=l.COMMANDS;break;case("pwd","env","whoami","users","dstat","dload","encrypt","decrypt"):break;default:let e=i[i.length-1].replace(/\/\w+?$/,"/");try{n=this.entries(this.path(e,a.FILE,this.pwd)).map((t)=>t.path)}catch(t){try{n=this.entries(this.path(e,a.FOLDER,this.pwd)).map((t)=>t.path)}catch(t){n=[]}}}let d=new RegExp("^"+i[i.length-1],"i"),s=n.filter((e)=>d.test(e));if(1===s.length){t.text(e.replace(new RegExp(i[i.length-1]+"s*$"),s[0]));let n,d;n=document.createRange(),n.selectNodeContents(t.get(0)),n.collapse(!1),d=window.getSelection(),d.removeAllRanges(),d.addRange(n)}}cmd_mkentry(e,t="",n=a.FOLDER){let i=(e.match(/\/([a-zA-Z.0-9]+)$/)||[,e])[1],d=this.path(e.replace(new RegExp(i+"$"),""),a.FOLDER,t);try{this.path(e,n,t)}catch(t){return this.create({name:i,parent:d,type:n,owner:this.user})}}cmd_remove(e){if(e.folder)for(let t=[e];t.length;){let e=t.pop(),n=this.entries(e);n.map((e)=>e.folder?t.push(e):e.blank=!0),e.blank=!0}else e.blank=!0}gui_window(e="",i=!1){let d={top:parseInt($(".app-controller .app-windows:last-of-type").css("top"))||l.OFFSET.TOP.MIN,left:parseInt($(".app-controller .app-windows:last-of-type").css("left"))||l.OFFSET.LEFT.MIN},a=$(`
                <div class="app-windows">
                    <div class="app-windows-bar">
                        <div class="app-windows-title">${e}</div>
                        <div class="app-windows-close">X</div>
                    </div>
                    <div class="app-windows-content">
                    </div>
                </div>`).appendTo(this.context);return d={top:n(0,t(d.top+l.OFFSET.TOP.VAL,l.HEIGHT-a.height()-5)),left:n(0,t(d.left+l.OFFSET.LEFT.VAL,l.WIDTH-a.width()-5))},a.css("left",d.left).css("top",d.top).click(()=>{$(".app-windows").removeClass("active"),a.addClass("active")}).addClass("active"),a.find(".app-windows-bar").mousedown((e)=>l.DRAGGING={x:e.pageX,y:e.pageY,context:a}),a.find(".app-windows-close").click(()=>a.remove()),i?a.find(".app-windows-content"):a}_gui_window_dragging(){$(".app-controller").mouseup(()=>l.DRAGGING=!1).mousemove((e)=>this._gui_window_dragged(e))}_gui_window_dragged(e){if(l.DRAGGING){let i=l.DRAGGING,d=i.context,a={x:parseInt(d.css("left"))+e.pageX-i.x,y:parseInt(d.css("top"))+e.pageY-i.y};l.DRAGGING={x:e.pageX,y:e.pageY,context:d},d.css("left",n(0,t(a.x,l.WIDTH-d.width()-5))).css("top",n(0,t(a.y,l.HEIGHT-d.height()-5)))}}gui_error(t){this.gui_window(t.name).addClass("app-windows-error").find(".app-windows-content").append(`<table><tr><td><img src="${l.ICONS.ERROR}" /></td><td>${t.message}</td></tr></table>`)}gui_alert(e,t,n){let i=this.gui_window(e).addClass("app-input").find(".app-windows-content");return i.append(`<table>
                <tr><td class="app-alert-msg">${t}</td></tr>
                <tr><td><button>${l.TEXT.VALIDATE}</button></td></tr>
            </table>`),n?i.find("button").click(()=>{n()}):i.find("button").click(()=>{i.parent().remove()}),i}}l.INVERT_CONTEXT=0.7,l.OFFSET={},l.OFFSET.TOP={VAL:10,MIN:40},l.OFFSET.LEFT={VAL:10,MIN:60},Object.defineProperty(l,"WIDTH",{get(){return $(".app-controller").width()}}),Object.defineProperty(l,"HEIGHT",{get(){return $(".app-controller").height()}}),l.WINDOW_WIDTH=300,l.WINDOW_HEIGHT=250,l.COMMANDS=["pwd","env","whoami","users","dstat","dload","encrypt","decrypt","adduser","deluser","su","explorer","terminal","edit","play","display","exec","cd","mkdir","mkfile","dformat","help","rm","chown","stat","chmod","mv","ls","tree"],l.TEXT={MK_NEW_FILE:$(".text-mk-new-file").text(),MK_NEW_FOLDER:$(".text-mk-new-folder").text(),PROPERTIES:$(".text-properties").text(),NAME:$(".text-name").text(),PARENT:$(".text-parent").text(),BLOCK:$(".text-block").text(),SIZE:$(".text-size").text(),TYPE:$(".text-type").text(),FILE:$(".text-type-file").text(),FOLDER:$(".text-type-folder").text(),VISIBILITY:$(".text-visibility").text(),VISIBLE:$(".text-visibility-visible").text(),HIDDEN:$(".text-visibility-hidden").text(),OWNER:$(".text-owner").text(),CREATION:$(".text-date-creation").text(),EDITION:$(".text-date-edition").text(),PERMISSIONS:$(".text-permissions").text(),PERMISSIONS_OWNER:$(".text-permissions-owner").text(),PERMISSIONS_OTHERS:$(".text-permissions-others").text(),PERMISSIONS_R:$(".text-permissions-r").text(),PERMISSIONS_W:$(".text-permissions-w").text(),PERMISSIONS_X:$(".text-permissions-x").text(),PERMISSIONS_D:$(".text-permissions-d").text(),PERMISSIONS_Y:$(".text-permissions-yes").text(),PERMISSIONS_N:$(".text-permissions-no").text(),TERMINAL:$(".text-terminal").text(),TERMINAL_FULL:$(".text-terminal-full").text(),SESSIONS:$(".text-sessions").text(),LOGGED_AS:$(".text-sessions-logged-as").text(),SESSIONS_USER:$(".text-sessions-user").text(),SESSIONS_PASSWORD:$(".text-sessions-password").text(),SESSIONS_REMOVE:$(".text-sessions-remove").text(),SESSIONS_CREATE:$(".text-sessions-create").text(),SESSIONS_LOGIN:$(".text-sessions-login").text(),MOVE_TO:$(".text-move-to").text(),VALIDATE:$(".text-validate").text(),INVALID_PATH:$(".text-move-to-invalid-path").text(),IMAGE_MANAGER:$(".text-image-manager").text(),CONFIG:$(".text-config").text(),CONFIG_Y:$(".text-config-yes").text(),CONFIG_N:$(".text-config-no").text(),CONFIG_SIGNATURE:$(".text-config-signature").text(),CONFIG_CRYPTED:$(".text-config-crypted").text(),CONFIG_SIZE:$(".text-config-size").text(),CONFIG_USED:$(".text-config-used").text(),CONFIG_FREE:$(".text-config-free").text(),CONFIG_WIDTH:$(".text-config-width").text(),CONFIG_HEIGHT:$(".text-config-height").text(),CONFIG_TABLE_SIZE:$(".text-config-table-size").text(),CONFIG_TABLE_EXTENDED:$(".text-config-extended").text(),CONFIG_ENTRY_NAME:$(".text-config-entry-name").text(),CONFIG_BLOCK_SIZE:$(".text-config-block-size").text(),CONFIG_BLOCK_NUMBER:$(".text-config-block-number").text(),ENCRYPTION:$(".text-encryption").text(),ENCRYPTION_TOOL:$(".text-encryption-tool").text(),ENCRYPTION_KEY:$(".text-encryption-key").text(),ENCRYPTION_ENCRYPT:$(".text-encryption-encrypt").text(),ENCRYPTION_DECRYPT:$(".text-encryption-decrypt").text(),ENCRYPTION_MISSING_KEY:$(".text-encryption-missing-key").text(),ENCRYPTION_SUCCESS:$(".text-encryption-success").text(),DECRYPTION_SUCCESS:$(".text-decryption-success").text(),SESSIONS_create_DONE:$(".text-sessions-create-done").text(),SESSIONS_remove_DONE:$(".text-sessions-remove-done").text(),SESSIONS_login_DONE:$(".text-sessions-login-done").text(),IMAGE_MANAGER_STEGANO:$(".text-image-manager-stegano").text(),EXPLORER:$(".text-explorer").text(),STEGANOGRAPHY_TOOL:$(".text-steganography-tool").text(),OPEN_WITH:$(".text-open-with").text(),RENAME:$(".text-rename").text(),REMOVE:$(".text-remove").text(),OPEN_WITH_TEXT:$(".text-open-with-text").text(),OPEN_WITH_IMAGE:$(".text-open-with-image").text(),OPEN_WITH_AUDIO:$(".text-open-with-audio").text(),OPEN_WITH_CMD:$(".text-open-with-cmd").text(),STEGANOGRAPHY_INFO:$(".text-steganography-info").text(),SCRIPT:$(".text-script-msg").text(),SHOW_HIDDEN:$(".text-show-hidden").text(),CLIPPY:$(".text-clippy-msg").text(),IMAGE_SAVE:$(".text-image-save").text()},l.ICONS={_DIR:"gui/",SAVE:"gui/save.png",IMG:"gui/file-img.png",AUDIO:"gui/file-audio.png",TEXT:"gui/file-text.png",CONF:"gui/file-conf.png",CMD:"gui/file-cmd.png",ERROR:"gui/error.png",FOLDER_EMPTY:"gui/folder-empty.png",FOLDER_FILES:"gui/folder-files.png"},e.Lowlight.FileSystem={Block:i,Entry:a,Utf8:s,Image:r,PictureImage:o,Interface:c,GUI:l}})("undefined"==typeof window?this:window);